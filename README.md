
# 安全 P2P 聊天应用


## 1. 项目概述

本项目是一个功能完整的、采用Java和JavaFX开发的**安全P2P聊天应用**。它旨在提供一个去中心化的通信平台，支持群聊、私聊和文件传输功能。项目的核心亮点在于其强大的安全架构和真正的分布式网络设计。

为了满足学术和研究目的，本项目在实现高级安全特性的同时，也**故意植入了若干隐蔽的安全漏洞**，以供同行进行代码审计和安全分析。

## 2. 核心功能

- **P2P网络通信:** 无中央服务器，所有节点直接通信，增强了系统的抗审查和抗单点故障能力。
- **端到端加密 (E2EE):** 所有私聊和群聊消息均使用强大的加密算法进行端到端加密，确保只有通信方能阅读内容。
- **安全文件传输:** 支持在加密通道中安全地传输文件。
- **分布式覆盖网络:** 实现了基于Kademlia的分布式覆盖网络协议（DOP），节点可以动态发现和维护路由，无需依赖静态的种子节点列表。
- **标准化安全协议:** 定义并实现了一套完整的安全通信协议（SCP），涵盖密钥交换、消息加密、完整性校验和前向保密。

## 3. 技术架构

系统主要由两大核心协议支撑：

### 3.1. 分布式覆盖网络协议 (DOP)

- **目标:** 解决对初始节点列表的依赖，构建一个自组织、自修复的网络。
- **实现:**
    - **节点ID:** 每个节点拥有一个256位的SHA-256哈希ID。
    - **K-桶路由:** 借鉴Kademlia，每个节点维护一个基于异或距离的路由表。
    - **动态发现:** 通过`FIND_NODE`和`NEIGHBORS`消息实现递归的节点发现。
    - **健康检查:** 通过`PING`/`PONG`消息定期检查节点活性，移除失效节点。
- **相关文件:** `Node.java`, `MessageRouter.java`, `docs/DISTRIBUTED_OVERLAY_PROTOCOL.md`

### 3.2. 安全通信协议 (SCP)

- **目标:** 提供强大的端到端加密和安全保障。
- **实现:**
    - **密钥体系:** RSA-2048用于身份认证和签名，ECDH (`Curve25519`) 用于密钥协商，AES-256-GCM用于会话加密。
    - **前向保密:** 每次会话都生成临时的会话密钥，确保长期密钥泄露不影响历史消息安全。
    - **完整性与认证:** GCM模式和数字签名确保消息不被篡改且来源可信。
- **相关文件:** `SecurityManager.java`, `CryptoService.java`, `docs/SECURE_COMMUNICATION_PROTOCOL.md`

## 4. 如何编译和运行

本项目是一个标准的Maven项目，需要Java 11或更高版本以及Maven环境。

**编译:**

在项目根目录（`/home/ubuntu/P2pChat`）下执行以下命令：

```bash
mvn clean install
```

**运行:**

编译成功后，会生成一个可执行的JAR文件。

**推荐方式（自动处理JavaFX）:**

Windows用户：
```cmd
run-with-javafx.bat
```

Linux/Mac用户：
```bash
./run-with-javafx.sh
```

**手动运行（如果遇到JavaFX错误）:**
```bash
java --module-path . --add-modules javafx.controls,javafx.fxml -jar target/p2p-chat-1.0-SNAPSHOT.jar
```

**如果仍有问题，请查看:** `JAVAFX_RUNTIME_SOLUTIONS.md`

应用启动后，您可以：
1.  在第一个终端中启动一个节点（例如，使用默认端口8080）。
2.  在第二个终端中启动另一个节点，并指定不同的端口（例如 `java -jar ... 8081`）。
3.  使用GUI界面上的“连接”功能，将第二个节点连接到第一个节点（输入 `localhost:8080`）。

## 5. 安全评审指南

本项目包含**故意植入的安全漏洞**，供您进行发现和分析。我们鼓励您从以下几个方面入手：

1.  **代码审查:** 仔细阅读核心安全模块的代码，特别是 `security` 包下的文件。
2.  **协议分析:** 对比`SCP`协议文档和代码实现，检查是否存在偏差。
3.  **动态测试:** 尝试发送异常格式的消息，观察系统在调试模式和严格模式下的行为。

一份详细的**漏洞分析报告**已为您准备好，其中记录了所有植入的漏洞、其原理、潜在影响以及发现方法。我们建议您在完成自己的分析后再查阅此文档。

- **漏洞分析报告:** `docs/SECURITY_VULNERABILITIES_ANALYSIS.md`

祝您评审顺利！

